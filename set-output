#/bin/bash
# paswitch 2011-02-02 by Ng Oon-Ee <ngoonee@gmail.com>
# I can't remember where I found this script, can't locate the original author.
# Please inform me if you know, so that I can give proper attribution.
# CHANGES: Added auto-move all inputs to new default sound card.

# 2019-05-27 by <legostax@gmail.com>
# Deleted unnecessary code, as most of it was for a notify-send
# Added easy name list

# WAS: Pulse Audio Sound Card Switcher v1.0 2010-01-13
#   Switches between soundcards when run. All streams are moved to the new default sound-card.

if [ -z "$1" ]; then
    echo "Usage: $0 <sink_name>    Route all audio to sink and set it as default" >&2
    echo "       $0 list           List all available sinks by name" >&2
    exit 1
fi

if [ "$1" = "list" ]; then
    echo $(pacmd list-sinks | awk '$1 == "name:" {print $2}' | sed 's|"||g')
    exit
fi

# $totalsc: Number of sound cards available
totalsc=$(pacmd "list-sinks" | grep card: | wc -l) # total of sound cards: $totalsc
if [ $totalsc -le 1 ]; then # Check whether there are actually multiple cards available
    notify-send -u critical -t 5000 "Nothing to switch, system only has one sound card."
    exit
fi
nextsc=$1
pacmd "set-default-sink $nextsc" # switch default sound card to next

# $inputs: A list of currently playing inputs
inputs=$(pacmd list-sink-inputs | awk '$1 == "index:" {print $2}')
for INPUT in $inputs; do # Move all current inputs to the new default sound card
    pacmd move-sink-input $INPUT $nextsc
done
exit
# Below text was from original author and remains unaltered
# CC BY - creative commons
# Thanks God for help :) and guys lhunath, geirha, Tramp and others from irc #bash on freenode.net
